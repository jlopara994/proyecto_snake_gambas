' Gambas class file

Private cuerpo As New Cuadrado[]
Private direccion As String = "D"
Private Const SIZE As Short = 20

Public Sub _new(posX As Short, posY As Short, color As Integer)
  
  Dim cabeza As Cuadrado 
  cabeza = New Cuadrado(posX, posY, SIZE, color)
  cuerpo.Add(cabeza)
  
End

Public Sub Dibujar(drawingarea As DrawingArea)
  
  For Each parte As Cuadrado In cuerpo
    
    parte.Dibujar(drawingarea)
    
  Next
  
End

Public Sub Crecer()
  
  ' Crear un nuevo cuadrado asignandole
  Dim cabezaAntigua As Cuadrado = cuerpo[0]
  Dim nuevaCabeza As Cuadrado = New Cuadrado(cabezaAntigua.getX(), cabezaAntigua.getY(), SIZE, cabezaAntigua.getColor())
  ' Añadir al cuerpo
  cuerpo.Add(nuevaCabeza, 0)
  
  nuevaCabeza.Mover(direccion)
    
End 

Public Sub Mover()
  
  'Mover el ultimo cuadrado al principio y moverlo hacia la dirección que coorresponda
  Me.Crecer()
  cuerpo.Pop()
  
End

Public Sub CambiarDir(nuevaDireccion As String)

  Select nuevaDireccion
    Case "W"
      If (Not (direccion == "S")) Then
        direccion = nuevaDireccion
      Endif
    Case "A"
      If (Not (direccion == "D")) Then
        direccion = nuevaDireccion
      Endif
    Case "S"
      If (Not (direccion == "W")) Then 
        direccion = nuevaDireccion
      Endif  
    Case "D"
      If (Not (direccion == "A")) Then
        direccion = nuevaDireccion
      Endif
  End Select
  
End

Public Sub EstasMuerto(canvas As DrawingArea) As Boolean
  
  Dim x As Short = cuerpo[0].getX()
  Dim y As Short = cuerpo[0].getY()
  
  If (x > canvas.W Or x < 0 Or y > canvas.H Or y < 0) Then 
    'Salirse por los lados
    Return True
  Else 
      For i As Short = 4 To cuerpo.Length - 1
        If (cuerpo[0].Colisiona(cuerpo[i])) Then
          Return True
        Endif
      Next
  Endif
  
  Return False
  
End

Public Sub getCabeza() As Cuadrado  
  
  Return cuerpo[0]
  
End

Public Sub getDireccion() As String
  
  Return direccion
  
End


Public Sub estaColisionando(cuadrado As Cuadrado) As Boolean
  
  For i As Integer = 0 To cuerpo.Length - 1
    
    If cuerpo[i].Colisiona(cuadrado) Then
      Return True
    Endif
    
  Next
  
  Return False
  
End


